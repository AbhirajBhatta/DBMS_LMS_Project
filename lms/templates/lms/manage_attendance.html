{% extends 'base.html' %}
{% block title %}Manage Attendance — {{ classroom.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h3 class="text-light mb-3">
    {{ classroom.name }}
    <span class="text-secondary">({{ classroom.code }})</span>
  </h3>

  <!-- Date Selector -->
  <form method="get" class="mb-3 d-flex gap-2 align-items-center">
    <label class="text-secondary small mb-0">Select Date:</label>
    <input type="date"
        name="date"
        value="{{ selected_date|date:'Y-m-d' }}"
        min="{{ classroom.start_date|date:'Y-m-d' }}"
        max="{{ today|date:'Y-m-d' }}"
        class="form-control w-auto bg-dark text-light border-secondary">
    <button type="submit" class="btn btn-outline-info btn-sm">Load</button>
  </form>

  <!-- Attendance Form -->
  <form method="post" class="card p-4 shadow-sm" style="background-color:#161b22;">
    {% csrf_token %}
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="text-light mb-0">
        Mark Attendance for {{ selected_date }}
      </h5>
      <div class="d-flex gap-2">
        <button type="submit"
                name="clear_logs"
                class="btn btn-outline-danger btn-sm"
                onclick="return confirm('Are you sure you want to clear attendance logs for {{ selected_date }}?');">
          Clear Logs
        </button>
        <button type="submit" class="btn btn-success btn-sm">Save Attendance</button>
      </div>
    </div>

    <div class="text-secondary small mb-3">
      Valid attendance period:
      <span class="text-light">{{ classroom.start_date }}</span>
      → 
      <span class="text-light">{{ today|date:'Y-m-d' }}</span>
    </div>

    <table class="table table-dark table-striped align-middle">
      <thead>
        <tr>
          <th>Student</th>
          <th>Register No</th>
          <th>Present</th>
        </tr>
      </thead>
      <tbody>
        {% for e in students %}
        <tr>
          <td>{{ e.student.username }}</td>
          <td>{{ e.student.profile.reg_no }}</td>
          <td>
            <input type="checkbox"
                   name="present_{{ e.id }}"
                   {% if attendance_map.e.id %}checked{% endif %}>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-secondary text-center">No students enrolled.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
</div>
{% endblock %}
